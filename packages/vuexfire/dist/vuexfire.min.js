/*!
 * vuexfire v2.1.1
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VuexFire=e.VuexFire||{})}(this,function(e){"use strict";function t(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){return"function"==typeof e.key?e.key():e.key}function c(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function i(e){var t=e.val(),c=n(t)?t:{".value":t};return c[".key"]=r(e),c}function o(e){var t=e.key,n=e.source,r=e.cancelCallback,c=e.commit,o=e.state;return{value:n.on("value",function(e){c(d,{type:d,key:t,record:i(e),state:o})},r)}}function a(e){var n=e.key,c=e.source,o=e.cancelCallback,a=e.commit,u=e.state;a(l,{type:l,state:u,key:n});var s=c.on("child_added",function(e,r){var c=u[n],o=r?t(c,r)+1:0;a(y,{type:y,state:u,key:n,index:o,record:i(e)})},o),f=c.on("child_removed",function(e){var c=t(u[n],r(e));a(E,{type:E,state:u,key:n,index:c})},o);return{child_added:s,child_changed:c.on("child_changed",function(e){var c=t(u[n],r(e));a(v,{type:v,state:u,key:n,index:c,record:i(e)})},o),child_removed:f,child_moved:c.on("child_moved",function(e,c){var o=u[n],s=t(o,r(e)),f=c?t(o,c)+1:0;a(k,{type:k,state:u,key:n,index:s,newIndex:f+=s<f?-1:0,record:i(e)})},o)}}function u(e){var t=e.state,r=e.commit,i=e.key,u=e.source,f=e.options,d=f.cancelCallback,l=f.readyCallback;if(!n(u))throw new Error("VuexFire: invalid Firebase binding source.");if(!(i in t))throw new Error("VuexFire: cannot bind undefined property '"+i+"'. Define it on the state first.");var y=_.get(r);y||(y={sources:Object.create(null),listeners:Object.create(null)},_.set(r,y)),i in y.sources&&s({commit:r,key:i}),y.sources[i]=c(u);var v;v=t[i]&&"length"in t[i]?a({key:i,source:u,cancelCallback:d,commit:r,state:t}):o({key:i,source:u,cancelCallback:d,commit:r,state:t}),y.listeners[i]=v,l&&u.once("value",l)}function s(e){var t=e.commit,n=e.key,r=_.get(t);if(r||(r={sources:Object.create(null),listeners:Object.create(null)},_.set(t,r)),!(n in r.sources))throw new Error("VuexFire: cannot unbind '"+n+"' because it wasn't bound.");var c=r.sources[n],i=r.listeners[n];for(var o in i)c.off(o,i[o]);delete r.sources[n],delete r.listeners[n]}function f(e){return function(t,n){var r=t.state,c=t.commit;return t.bindFirebaseRef=function(e,t,n){return void 0===n&&(n={}),u({state:r,commit:c,key:e,source:t,options:n})},t.unbindFirebaseRef=function(e){return s({commit:c,key:e})},e(t,n)}}var d="vuexfire/OBJECT_VALUE",l="VUEXFIRE_ARRAY_INITIALIZE",y="vuexfire/ARRAY_ADD",v="vuexfire/ARRAY_CHANGE",k="vuexfire/ARRAY_MOVE",E="vuexfire/ARRAY_REMOVE",R=Object.freeze({VUEXFIRE_OBJECT_VALUE:d,VUEXFIRE_ARRAY_INITIALIZE:l,VUEXFIRE_ARRAY_ADD:y,VUEXFIRE_ARRAY_CHANGE:v,VUEXFIRE_ARRAY_MOVE:k,VUEXFIRE_ARRAY_REMOVE:E}),b={};b[d]=function(e,t){var n=t.key,r=t.record;e[n]=r},b[l]=function(e,t){e[t.key]=[]},b[y]=function(e,t){var n=t.key,r=t.index,c=t.record;e[n].splice(r,0,c)},b[v]=function(e,t){var n=t.key,r=t.index,c=t.record;e[n].splice(r,1,c)},b[k]=function(e,t){var n=t.key,r=t.index,c=(t.record,t.newIndex),i=e[n];i.splice(c,0,i.splice(r,1)[0])},b[E]=function(e,t){var n=t.key,r=t.index;e[n].splice(r,1)};var A={};Object.keys(R).forEach(function(e){var t=R[e];A[t]=function(e,n){b[t](n.state,n)}});var _=new WeakMap;e.firebaseMutations=A,e.firebaseAction=f,Object.defineProperty(e,"__esModule",{value:!0})});